\documentclass[10pt, a4paper]{report}

\title{Cycling simulation\\or\\\textit{When} to break away?}
\date{\today}
\author{Dan Demeter, Robert Kruszewski, Alexandru P\u{a}unoiu\\ C\'esar Prout\'e, Julian Sutherland}

\usepackage{tabularx, alltt, amsmath, multirow, graphicx}

\begin{document}
\maketitle

\tableofcontents

\chapter{Executive Summary}

Cycling races are amongst one of the most popular sports worldwide. Their history dates back to the 
$18^{th}$ century being adopted and since then the types of races spanned substantially: from Track cycling on banks and velodromes,
Cyclo-cross, Mountain bike races, one-day road race, criterium or time trial to professional races such as 
Tour de France, Giro d'Italia or Vuelta a Espa\~na. During those professional races it is expected that a group of riders break away
from the main group and cooperate with each other in order to gain advantage from the main group ( called peleton ). Riders in such a 
group are forced to cooperate with each other, even though their chances of winning are decreasing as more members join the break away 
group. Also, when a breakaway group is being formed, riders from the peleton have to decide whether to chase it down or remain where 
they are.  

During the race, based on their remaining strength, remaining distance untill the finish line and other factors riders need to decide 
fast their next move. There are countless(?!) examples when the rider's hesitation or bad decision costed him the grand title. From our 
%
point of view, all these decisions can be modelled by a Game Theory strategy. During our project, we have tried to find optimum strategies that can be applied to various cycling races. We have proposed a Game Theory model based on our research and an independent simulation used to verify our model. We continued the work of [ cite the papers here] and try to obtain a model that is as appripriate as real life cycling races. Using our simulation combined with the game theory model we believe that one should be able to simulate any Professional cycling race. Coaches and racers can use this data then to compare decisions taken  during the race. Our project aims to combine both Game Theory strategies with data from multiple simulated races in order to output 'optimal' decisions 


\chapter{Introduction}

-- Motivation

The first cycling race was 




-- Objectives

-- Achievements (yeah right :D)

\chapter{Design and Implementation}

\section{The model}

-- How it works, where it comes from.

\section{Runge-Kutta}

% Initial equations

Runge-Kutta is a standard numerical method that allows one to estimate a function based on an initial value and its differential. Its a lot like the standard newton method ( basically $f(x + h) \approx f(x) + h*f'(x)$ ) but it uses several points inside a trapezium to trace the function significantly better.

However, you're going to say this is all very nice and it might well be useful for a first order differential equation, but we have a second order non-linear differential equation. Well one might notice that it is infact possible to adapt this method to tracing two (or more) interdependent functions (whos value depends on the value of the other) over the same variable (t) with two initial conditions. So if we can transform our second order differential equation into two first order ones, we can use Runge-Kutta to solve it numerically and then derive any necessary values from the result.

For the following equations we will use the next simbols: \\

\begin{tabularx}{\linewidth}{|c|X|}
\hline
P is power	&	\_pot is potential energy	\\
T is torque	&	\_air is air drag			\\
F is Force 	&  	\_bear is friction in the wheel bearings \\
			& 	\_roll is the rolling friction (with the road) \\
			& 	\_kin is kinetic energy \\
			&	\_ped is cyclist's 'input' (e.g. $P_{ped}$ = power inputed into the system) \\
\hline
\multicolumn{2}{|c|}
{
	$l_{c}$  is the length of the cycling crank and
	% maybe use a parbox here? http://tex.stackexchange.com/questions/485/how-to-break-a-line-in-a-table
	$r_{w}$  is the radius of the wheel
} \\
\hline
\end{tabularx}

\vspace*{1cm}

$\eta$ 		represents the frictional losses in the drive chain \\
$\omega$ 	represents angular velocity.\\
$\gamma$	is the step-up coefficient the bicycles gearing system.  \\

So by conservation of energy:

$$P_{pot} + P_{air} + P_{bear} + P_{roll} + P_{kin} = \eta * P_{ped}$$

As $Power = Torque * \omega$ , by dividing with $\omega$ we get

$$ T_{pot} + T_{air} + T_{bear} + T_{roll} + T_{kin} = \frac{ \eta * T_{ped} }{ \gamma }  = \frac{\eta * P_{ped}}{\omega * \gamma} $$

From the above notations have $T_{ped}$ = $F_{ped} * l_{c}$ (due to mechanical advantage) and $T = \frac{F * l_{c}}{r_{w}}$ for all the other forces (as there is a dual mechanical advantage between the crank and the wheel)

This gives us: $$ F_{pot} + F_{air} + F_{bear} + F_{roll} + F_{kin}
	= \frac{ \eta * l_{c} * T_{ped} }{ \gamma }
	= \frac{ \eta * l_{c} * P_{ped} }{ r_{w} * (\omega * \gamma)} $$

As we assume the race is on a perfectly flat surface, then $F_{pot} = 0$. We also assume that the bicycle is 'perfect', so $F_{bear} = 0$. \\\\
This simplifies to: $$F_{air} + F_{kin} = \frac{l_{c} * P_{ped} }{ \omega * \gamma } $$

where $$ F_{air} 	= \frac{1}{2} * c_{d} * \rho * A * ( x'(t) )^{2} $$
and	  $$ F_{kin} 	= ( m + ( \frac{l_w}{r_w^{2}} ) * x''(t) $$

Results from the Paper (...)\\

We are using the following estimates:

\begin{alltt}
mass of cyclist (m) 				= 63
frontal area of cyclist (A) 		= 0.75
length of crank (\(l_{c}\)) 		= 0.2
air density (\(\rho\)) 				= 1.225 (sea level, 15 degree Celsius)
drag coefficient of a cyclist (d) 	= 0.7
wheel inertia (\(I_w\)) = 0 (as perfect bicycle)
radius of wheel (\(r_w\)) = 0.35
step-up coefficient of gearing (\(\gamma\)) = 7.5
angular velocity of wheels (\(\omega\)) = \(2 * \pi * speed / {r_{w}} \)
\end{alltt}

Therefore the differential equation simplifies to:
$$ 0.3215625 * (x'(t))^{2} + 63 * x''(t)
	= \frac{\eta * l_{c} * P_{ped}} {2 * \pi * x'(t) * \gamma }
	= \frac {0.2 * P_{ped}} {15 * \pi} $$

Which gives approximation of:
$$ 75.7664 *(x'(t))^{3} + 14844.025288499999 * x'(t) * x''(t) = P_{ped}$$

which is a second order non-linear differential equation.\\\\
In order to apply the Runge-Kutta algorithm, we need to transform it into two linear differential equations. We will define 2 independent variables, $y_1$ and $y_2$ such that their differentials $y_1'$ and $y_2'$ must depend on the variables t, $y_1$ and $y_2$. Let
$$ y_1' = f( t, y_1, y_2 )$$ and $$y_2' = g( t, y_1, y_2 )$$

In order to get x'(t) we want to set one of the equations to contain it: $y_1 = x'(t)$ and because we want one of the equations to contain $x'(t) * x''(t) $ so set: $y_2' = x'( t ) * x''( t )$ .
This gives us $$ y_{2} = \frac{1}{2} * x'(t)^2 $$
By rearranging the differential equation to have only $ x'( t ) * x''( t )$ on the left hand side, we get
$$ x'( t ) * x''( t ) = \frac{P_{ped} - 75.7665 * x'( t ) ^ 3}{14844.025288499999}$$
$$ y_2' = \frac{P_{ped} - 75.7665 * x'( t ) ^ 3}{14844.025288499999}$$

Now we have only $y_2'$ in terms of only t, $y_1$ and $y_2$ so we can set $$ g( t, y_1, y_2 ) = \frac{P_{ped} - 75.7665 * x'( t ) ^ 3}{14844.025288499999}$$

Writing $y_1$ in terms of t, $y_1$ and $y_2$: $$y_2 = \frac{1}{2} * x'(t)^2$$ yelds $$y_2 = \frac{1}{2} * y_1^2$$
And by rearranging the left hand side we get:
$$y_1 = \sqrt{2 * y_2}$$
Now we differentiate with respect to $t$:
\begin{align*}
y_1' & = \frac{y_2'}{\sqrt{2 * y_2}}\\
& = \frac{P_{ped} - 75.7665 * x'( t ) ^ 3}{14844.025288499999 * \sqrt{2 * y_2}}
\end{align*}
This gives us the final form for function f:
$$ f(t, y_1, y_2) = \frac{P_{ped} - 75.7665 * x'( t ) ^ 3}{14844.025288499999 * \sqrt{2 * y_2}}$$

% Game theoretical model introdutcion

\section{Game Theory model introduction}

In order to create a thorough mathematical model, we aim at constructing a game theoretical model. This model will help racers to change their strategies and choose the optimal one as the race unfolds.\\

Modelling bike races can be quite challenging, hence we will begin with the simplest case in order to introduce our methodology and explain the simplifying assumptions we are making. When participating in a race we can argue that racers are at each point faced with three possible options: breaking away from a group, fall back to group preceding the current one and cooperate with other members of the group (which essentially means to copy strategy of other players - which will be discussed later). Each of the racers can change his mind as often as he wants, however, changes in strategy will likely incur penalties on their performance. In this section we try to determine whether there is one dominant strategy and try to find at which point in race it is beneficial for racer to change his strategy. We can easily see that strategy chosen by players will depend on their skills and fitness, i.e. better racers can afford more aggressive, less cooperative strategy in hope of being able to outdistance opponents. On the other hand weaker players will tend to cooperate more. The difficulty of this part is not the actual solution to the model since it might happen there will not be a general solution but fitting the model to the actual situation. It is fairly easy to construct arbitrary game theoretical games, however, when the games have to even remotely represent reality they get complicated very quickly.\\

We start by discussion of case with two racers when the group chasing them is very far from them and does not affect the strategies. Thus, they are guaranteed to come first and second. We can clearly see that this is a zero-sum game since we can only gain place if our opponent loses one. We can argue that race is a zero-sum game in general regardless on number of players, however, we will leave discussion of this theory for later and we will see that the answer is not so obvious when we want to arrive at meaningful results. Since we have already concluded that this is the simplest of game theoretical models, we need to investigate actual pay off matrix for this game.

\subsection{Preliminaries}
Before we can dive into discussion of game theory can be used to approach bicycle racing problem we must introduce the terms we are making use of.

\paragraph{Breaking away} ~\\
We assume that when cyclist breaks away he does so with maximum possible speed. Hence, he is expending as much energy as possible.

\paragraph{Cooperation} ~\\
For a racer to cooperate means to follow the strategy of racers in the group. If there are more than two racers we assume that racers willing to cooperate will cooperate with break aways and not stay in the group. When there are no break aways cooperation will preserve current status of the game.

\paragraph{Fall back} ~\\
When a racer falls back he limits his velocity so that he will get caught by the group preceding the one he is part of at the moment of making decision. If there is no group to fall back to the racer moves to further position in the group. This action isn't instantaneous, however, we assume that racers will not form a group between falling back from one group to another.

\paragraph{Value Of A Game} ~\\
For a zero-sum game value of that game is the expected value to one of the players when both play a perfect strategy.

\paragraph{One-off Game} ~\\
This is a game played at some moment $\delta^{(n)}$ before race finish line which determines payoff at given moment.

\subsection{Zero sum game}
Let us consider the length of the race to be $R > 0$. In order to reason about the pay off of each player when choosing a certain strategy during the race, it is best to single out a moment when the choice of each player is clear. Hence, in the case we are currently discussing (two racers broke away from the chasing group and it is certain they cannot be caught), we easily realize that in the last $\delta\ km$, where $\delta\ll R$, the two players will definitely choose to breakaway and push as hard as possible in order to win the race. This will have pay off $C_i>0$ for player $i$, where $i \in \{1,2\}$.
\\\\
Let us now consider the moment $\delta'$, with $\delta'>\delta$ and $\delta'\ll R$. We can easily infer that the pay off for each player $i$ is $\max\{C_i,V_{\delta'_i}\}$, where $V_{\delta'_i}$ is the value of the one-off game at moment $\delta'$ for player $i$. By continuing in this manner we get that at moment $\delta^{(n)}$, with $\delta^{(j)}>\delta^{(i)}$ for all $j>i$ and $\delta^{(0)}=\delta$ we have that the pay off for each player $i$ is $P_{i,n} = \max\{P_{i,n-1},V_{\delta^{(n)}_i}\}$, where $P_{i,0} = C_i$. Hence, we have deduced a recursive relation that lets us easily reason about the choice of strategies.
\\\\
In order to get the one-off game pay-off matrices we need the following formulas:\\
$CS_{i,n} = \dfrac{P_{ped_{i,n}} \cdot \delta^{(n)}}{E_{i,n} \cdot v},\ i\in\{1,2\}$ - the interpretation of this coefficient is the proportion of energy we have to reach finish at given speed, calculated at moment $\delta^(n)$.\\
$CF_{draft}(x)=(0.62 - 0.0104d_w + 0.0452 d_w^2)\cdot (1/2)\cdot c_d\cdot \rho\cdot A\cdot x^2$ -  represents the force applied to the cyclist due to the aerodynamic drag from the air taking into account the slipstream effect. In this case the $x$ is the speed of the cyclist.
$P = \dfrac{CS_{1,n}}{CS_{1,n}+CS_{2,n}}$ - the probability of player 1 being in front on player 2 at moment $\delta^{(n)}$ depending on their $CS_{i,n}$.
\\\\
We will list the possible strategy combinations with their respective pay-off players might use during the game. Before doing so, let us define $CF_{max}$ to be the maximum draft a player can attain, and $CF_{min}$ the minimum one.
\\\\
\textbf{Player 1 Cooperates, Player 2 Cooperates}
\\
The pay-off for Player 1 is $(1-P)\cdot CF_{draft}(s_1)$ and $P \cdot CF_{draft}(s_2)$ for Player 2, where $s_i$ is the speed of Player $i$. The pay-off for the two players is as such because if they cooperate they gain an advantage by drafting one behind the other ($CF_{draft}(s_i)$). This advantage, however, is greater for the player behind as he will put less effort, hence we need the probability $P$ of Player 1 having first place.
\\\\
We now need to normalize these quantities such that we get a pay-off in the interval [1,2], where 1 represents the worst pay-off (i.e. second place) and 1 the best (i.e. first place). After normalization we get that the pay-off for Player 1 is $(1-P)\cdot \dfrac{CF_{draft}(s_1)}{CF_{max}} + 1$ and the one for Player 2 is $P\cdot \dfrac{CF_{draft}(s_2)}{CF_{max}} + 1$. 
\\\\
The reasoning behind the normalization is as follows:\\
Let us consider the pay-off for Player 1 (for Player 2 we reasoning is similar). Notice that is $P=1$, then the formula is 0. Let us multiply it by a normalization coefficient $N$ and add 1 to the formula. We get $(1-P)\cdot N\cdot CF_{draft}(s_1)  + 1$. Thus, if we replace $CF_{draft}(s_1)$ by $CF_{max}$, then this yields the following inequality: $(1-P)\cdot CF_{max} \cdot N + 1\le 2$. After several easy computations we get $N = \dfrac{1}{CF_{max}}$. Replacing it in the equation, we get the result. Note that the other inequality - $\ge 1$ - holds trivially.
\\\\
\textbf{Player 1 Cooperates, Player 2 Breaks-away}
\\
Player 1's pay-off is clearly the same as before, i.e. $(1-P)\cdot \dfrac{CF_{draft}(s_1)}{CF_{max}} + 1$ - after normalization. Because of the fact that Player 2 breaks-away then his pay-off depends on his positioning i.e. $1-P$, but we must also take into account whether or not he is trailing behind Player 1 and hence, if he can get any benefit from drafting. Thus, we can argue that his pay-off is in fact $(1-P)\cdot P\cdot \dfrac{CF_{draft}(s_2)}{CF_{max}} + 1$ - after normalization. To explain it a bit more, $P\cdot \dfrac{CF_{draft}(s_2)}{CF_{max}}$ this is the part of the pay-off that tells him the benefit he gets from drafting. We then want to specify that his pay-off also depends on the probability of him being in front and hence we multiply by $1-P$.
\\\\
\textbf{Player 1 Cooperates, Player 2 Falls back}
\\
\textbf{Player 1 Breaks-away, Player 2 Cooperates}
\\
\textbf{Player 1 Breaks-away, Player 2 Breaks-away}
\\
\textbf{Player 1 Breaks-away, Player 2 Falls back}
\\
\textbf{Player 1 Falls back, Player 2 Cooperates}
\\
\textbf{Player 1 Falls back, Player 2 Breaks-away}
\\
\textbf{Player 1 Falls back, Player 2 Falls back}

\newcommand{\fallbreak}[2]{$(\begin{cases}#1, & \mbox{if } #1 < 1 \\ 0, & \mbox{if } #1 \ge 1\end{cases},\begin{cases}0, & \mbox{if } #2 < 1 \\ #2, & \mbox{if } #2 \ge 1\end{cases})$}
\newcommand{\breakfall}[2]{$(\begin{cases}0, & \mbox{if } #2 < 1 \\ #2, & \mbox{if } #2 \ge 1\end{cases},\begin{cases}#1, & \mbox{if } #1 < 1 \\ 0, & \mbox{if } #1 \ge 1\end{cases})$}

\begin{tabularx}{\textwidth}{ccXXX|}
& & \multicolumn{3}{ c }{Player 2} \\ \cline{3-5}
& & break away & cooperate & \multicolumn{1}{c}{fallback}  \\ \cline{3-5}
\multirow{3}{*}{\rotatebox{90}{Player 1}} &
\multicolumn{1}{ |c| }{break away} & $(P,P-1)$ & $(P\cdot CF_{draft}\cdot CS_1,(P-1)\cdot CF_{draft}\cdot CS_2)$ & \breakfall{CS_1}{CS_2} \\
& \multicolumn{1}{ |c| }{cooperate} & $(P\cdot CF_{draft}\cdot CS_1,(P-1)\cdot CF_{draft}\cdot CS_2)$ & $(P,P-1)$ & $(P\cdot CF_{draft}\cdot CS_1,(P-1)\cdot CF_{draft}\cdot CS_2)$ \\
& \multicolumn{1}{ |c| }{fallback} & \fallbreak{CS_1}{CS_2} & $(P\cdot CF_{draft}\cdot CS_1,(P-1)\cdot CF_{draft}\cdot CS_2)$ & $(P,P-1)$ \\ \cline{3-5}
\end{tabularx}

Where\\
$$P=\dfrac{CS_1}{CS_1+CS_2}$$

\chapter{Evaluation}

-- What did we manage to do ?

\chapter{Conclusion}

-- What have we learned ?

-- What could have been done differently ?

-- What could we do next ?

\chapter{Project Management}

-- How did we organise ? How did it work ?

\end{document}
